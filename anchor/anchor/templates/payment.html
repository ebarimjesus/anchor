
{% extends 'base.html' %}

{% block content %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Token Purchase</title>
    <script src="https://js.paystack.co/v1/inline.js"></script>
    <!-- Include the Flutterwave React component if needed -->
    <script src="https://checkout.flutterwave.com/v3.js"></script>

    <!-- Add your styles here -->
    <style>
        /* Apply a reset to remove default browser styles */
        body, div, p, label, input, button {
            margin: 0;
            padding: 0;
            border: 0;
            outline: none;
            font-size: 100%;
            font-family: Arial, sans-serif;
            box-sizing: border-box;
        }

        body {
            background-color: #ce6209;
        }

        .payment-container {
            max-width: 85%;
            margin: 0 auto;
            padding: 20px;
            border: 3px solid #09d309;
            border-radius: 15px;
            background-color: #000000;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-top: 50px;
            margin-bottom: 20px;
            color: rgb(49, 49, 240)
        }

        .payment-total-cost {
            margin-bottom: 20px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
        }

        .payment-total-cost p {
            margin: 15px 0;
        }

        label {
            display: inline-block;
            margin-right: 20px;
            font-weight: bold;
        }

        .payment-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .payment-button {
            display: block;
            padding: 10px 20px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        .payment-button:hover {
            background-color: #0056b3;
        }

        #transaction-status {
            font-weight: bold;
            margin-top: 10px;
        }

        /* Radio buttons */
        input[type="radio"] {
            margin-right: 5px;
        }

        /* Currency display */
        #total-amount-ngn {
            color: #009933;
            font-weight: bold;
        }

        /* Add styles for token options */
        .token-option {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
        }

        /* Style the radio button labels */
        .token-option label {
            position: relative;
            padding-left: 40px; /* Adjust the padding as needed to create space for the image */
            font-weight: bold;
        }

        /* Style the token images */
        .token-option img {
            width: 20px; /* Adjust the width and height of the images as needed */
            height: 20px;
            margin-right: 10px; /* Adjust the margin as needed to create spacing between the image and label */
            border-radius: 50%; /* Make the images circular if desired */
            object-fit: cover; /* Ensure the image fits within the specified dimensions */
            position: absolute;
            transform: translateY(-50%);
        }

        .max-image {
           max-width: 400px;
           max-height: 400px;
       }

        /* Mobile-friendly styles */
        @media screen and (max-width: 480px) {
            .payment-body {
                padding: 20px;
                align-items: flex-start;
            }
    
            .payment-container {
                margin: 0;
                border-radius: 0;
            }
    
            .payment-heading {
                margin-top: 0;
            }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <div class="payment-container">
        <img src="https://res.cloudinary.com/dp7civtid/image/upload/v1691869114/Go-Afro-Go_kflsey.png" class="max-image">
        <h1>Our Motivation</h1>
        <div>
            <p>Discover the incredible stories of Mitochondrial Eve and Y-chromosomal Adam, the common ancestors of all living humans, who lived in Africa thousands of years ago. Africa is the birthplace of Homo sapiens, where our species evolved, leaving an indelible mark on human history. Ancient African civilizations like Egypt, Mali, and Kush have contributed to the world's cultural heritage. Beyond history, Africa's rich biodiversity, captivating landscapes, and vibrant cultures continue to inspire.</p>
            <p>Embrace diversity, unity, and a better world by understanding Africa's pivotal role in human history. Celebrate the continent that birthed humanity, the home of ancient civilizations, and a land of endless wonders. Let Africa's stories kindle curiosity and appreciation for human heritage, and may our journey of discovery inspire positive impact on the world. Thank you for joining us on this enlightening experience.</p>
        </div>
        </div>
    </div>

    
    <div class="page-container">
        <div class="payment-container">
            <h1 class="payment-heading">Welcome to the AFRO Token ICO!</h1>
        
            <p class="payment-text">At AFRO Smartchain, we're thrilled to introduce you to the future of innovation. On January 1st, 2024, we will launch the AFRO Smartchain, a revolutionary blockchain platform designed to empower developers, entrepreneurs, and innovators across Africa and the world.</p>
        
            <p class="payment-text">The AFRO Smartchain is not just a blockchain; it's a canvas for endless possibilities. Here's why it's a game-changer:</p>
        
            <h2 class="payment-heading">Key Features:</h2>
            <ul>
                <li>**Scalability**: AFRO Smartchain is designed to handle a vast number of transactions (in thousands) per second utilizing the open source Hyperledger Sawtooth core, ensuring that it can support large-scale applications and services.</li>
                <li>**Security**: Our blockchain employs state-of-the-art security measures, safeguarding your data and assets with the utmost diligence.</li>
                <li>**Flexibility**: AFRO Smartchain provides developers with the freedom to create decentralized applications (dApps) tailored to their specific needs.</li>
                <li>**Interoperability**: Our platform seamlessly interacts with existing blockchain ecosystems, including Ethereum. This means you can leverage the power of both worlds. Dapps built on Ethereum can be hosted on the Afro Smartchain, and vice versa.</li>
                <li>**Low Transaction Costs**: AFRO Smartchain ensures that transaction fees remain minimal, making it cost-effective for users and developers alike.</li>
                <li>**Community-Driven**: We believe in the strength of community collaboration. AFRO Smartchain encourages active participation and governance by its users.</li>
            </ul>
        
            <p class="payment-text">As an investor in AFRO Token, the native currency of the AFRO Smartchain, you stand to benefit in numerous ways:</p>
        
            <h2 class="payment-heading">Investor Benefits:</h2>
            <ul>
                <li>**Potential for Growth**: AFRO Token has the potential to appreciate in value as the AFRO Smartchain gains traction and adoption.</li>
                <li>**Participation in Innovation**: By owning AFRO Tokens, you become a part of the innovation journey, supporting projects that drive positive change in Africa and globally.</li>
                <li>**Access to Exclusive Services**: AFRO Token holders may gain access to exclusive services, discounts, or opportunities within the AFRO Smartchain ecosystem and other projects like Zingy-AI {formaly called TalkGPT, our AI assistant with a voice and ears} at https://ai.zingypay.com, and the AFro Mart at https://test-app.zingypay.com.</li>
                <li>**Global Impact**: Your investment contributes to the development of groundbreaking solutions that address challenges not only in Africa but also on a global scale.</li>
            </ul>
        
            <p class="payment-text">Join us in revolutionizing the way we innovate, collaborate, and build a brighter future. Together, we'll unleash the potential of the AFRO Smartchain and empower innovators to create lasting change.</p>
        
            <p class="payment-text">Get ready to embark on this extraordinary journey with us. Stay tuned for updates and be prepared to secure your AFRO Tokens during the ICO, and when the Afro Smartchain launches on January 1st, 2024!</p>
        </div>
    
    <div class="payment-container">
        <h1 class="payment-heading">Token Purchase</h1>
        <div class="payment-total-cost">
            <p>1 AFRO Token (XLM) = $<span id="afro-bid-price">0.00</span> (Buy Price), $<span id="afro-bid-price-usd">0.00</span> USD</p>
            <p>1 AFRO Token (XLM) = $<span id="afro-ask-price">0.00</span> (Sell Price), $<span id="afro-ask-price-usd">0.00</span> USD</p>
        </div>
        <div class="payment-total-cost">
            <p>1 ÇNB Token (XLM) = $<span id="cnb-bid-price">0.00</span> (Buy Price), $<span id="cnb-bid-price-usd">0.00</span> USD</p>
            <p>1 ÇNB Token (XLM) = $<span id="cnb-ask-price">0.00</span> (Sell Price), $<span id="cnb-ask-price-usd">0.00</span> USD</p>
        </div>
        <div class="payment-total-cost">
            <p>1 LIFE Token (XLM) = $<span id="life-bid-price">0.00</span> (Buy Price), $<span id="life-bid-price-usd">0.00</span> USD</p>
            <p>1 LIFE Token (XLM) = $<span id="life-ask-price">0.00</span> (Sell Price), $<span id="life-ask-price-usd">0.00</span> USD</p>
        </div>
        <div class="payment-total-cost">
            <p>1 NATURE Token (XLM) = $<span id="nature-bid-price">0.00</span> (Buy Price), $<span id="nature-bid-price-usd">0.00</span> USD</p>
            <p>1 NATURE Token (XLM) = $<span id="nature-ask-price">0.00</span> (Sell Price), $<span id="nature-ask-price-usd">0.00</span> USD</p>
        </div>
        <div class="payment-total-cost">
            <p>1 OSO Token (XLM) = $<span id="oso-bid-price">0.00</span> (Buy Price), $<span id="oso-bid-price-usd">0.00</span> USD</p>
            <p>1 OSO Token (XLM) = $<span id="oso-ask-price">0.00</span> (Sell Price), $<span id="oso-ask-price-usd">0.00</span> USD</p>
        </div>

        <div class="token-option">
            <img id="afro-image" class="asset-image" src="https://res.cloudinary.com/dp7civtid/image/upload/v1692079822/AFRO_TOKEN_ndqlai.png" alt="AFRO Token Image">
            <label>
                <input type="radio" name="token-type" value="AFRO"> AFRO
            </label>
        </div>
        <div class="token-option">
            <img id="cnb-image" class="asset-image" src="https://res.cloudinary.com/dp7civtid/image/upload/v1695474886/CNB_bvlwjy.png" alt="ÇNB Token Image">
            <label>
                <input type="radio" name="token-type" value="ÇNB"> ÇNB
            </label>
        </div>
        <div class="token-option">
            <img id="life-image" class="asset-image" src="https://res.cloudinary.com/dp7civtid/image/upload/v1691841326/life-800x600_m22ylm.png" alt="LIFE Token Image">
            <label>
                <input type="radio" name="token-type" value="LIFE"> LIFE
            </label>
        </div>
        <div class="token-option">
            <img id="nature-image" class="asset-image" src="https://res.cloudinary.com/dp7civtid/image/upload/v1690650612/nature_pzqdla.png" alt="NATURE Token Image">
            <label>
                <input type="radio" name="token-type" value="NATURE"> NATURE
            </label>
        </div>
        <div class="token-option">
            <img id="oso-image" class="asset-image" src="https://res.cloudinary.com/dp7civtid/image/upload/v1695206993/oso_nwnm4h.png" alt="OSO Token Image">
            <label>
                <input type="radio" name="token-type" value="OSO"> OSO
            </label>
        </div>

        <!-- User input fields -->
        <div class="payment-user-info">
            <label class="payment-label" for="user-name">Full Name:</label>
            <input class="payment-input" type="text" id="user-name" placeholder="Enter your full name" required>

            <label class="payment-label" for="user-email">Email Address:</label>
            <input class="payment-input" type="email" id="user-email" placeholder="Enter your email" required>

            <label class="payment-label" for="user-phone">Phone Number:</label>
            <input class="payment-input" type="tel" id="user-phone" placeholder="Enter your phone number" required>

            <label class="payment-label" for="user-wallet">Wallet or Federation Address:</label>
            <input class="payment-input" type="text" id="user-wallet" placeholder="Enter your wallet or federation address" required>

            <!-- Add more fields as needed, such as name, address, etc. -->

            <label class="payment-label" for="amount">Enter the number of tokens you want to purchase:</label>
            <input class="payment-input" type="number" id="amount" min="1" step="1" placeholder="Enter the amount" required>
            <input type="hidden" id="selected-asset" value="">
            <input type="hidden" id="paystack-amount" name="paystack-amount" value=""> <!-- Hidden input for Paystack amount -->
        </div>

        <!-- Total cost display -->
        <div class="payment-total-cost">
            <p>Total Amount in USD: $<span id="total-amount">0.00</span> </p>
            <p> <span id="total-amount-ngn">0.00</span> </p>
        </div>

        <!-- Payment method selection -->
        <div class="payment-method-selection">
            <label>
                <input type="radio" name="payment-method" value="paystack" checked> Pay with Paystack
            </label>
            <label>
                <input type="radio" name="payment-method" value="flutterwave"> Pay with Flutterwave
            </label>
        </div>

        <!-- Transaction status display -->
        <div class="payment-total-cost">
            <!-- Transaction status will be displayed here -->
            <p id="transaction-status"></p>
        </div>

        <!-- Payment buttons -->
        <!-- Pay with Paystack button -->
        <button class="payment-button" id="paystack-button">Pay with Paystack</button>

        <!-- Add a hidden input fields for full name and phone number -->
        <input type="hidden" id="user-fullname" name="user-fullname" value="">
        <input type="hidden" id="user-phone-number" name="user-phone-number" value="">

        <!-- Pay with Flutterwave button -->
        <button class="payment-button" id="flutterwave-button">Pay with Flutterwave</button>

        <!-- Add a hidden input fields for full name and phone number -->
        <input type="hidden" id="user-fullname-flutterwave" name="user-fullname-flutterwave" value="">
        <input type="hidden" id="user-phone-number-flutterwave" name="user-phone-number-flutterwave" value="">
    </div>

    <!-- Discounted AFRO Token information -->
    <div class="payment-container">
        <h1 class="payment-heading">Special Offer: Discounted AFRO Tokens for First 1,000 People</h1>
        <p class="payment-text">As a token of appreciation for your support, we are offering a limited-time discount on AFRO Tokens! Within one week of the ICO offer, you can purchase AFRO Tokens at a reduced rate to enable us finish the development of the Afro Smartchain and its eventful launch. Moreso, we'll help you to sell 1000 AFRO Tokens to get cash deposited into your bank account the following day as a reward for your loyalty to the Afro race. Don't miss out on this exclusive opportunity to get involved in the AFRO Smartchain revolution at a discounted price.</p>
        <p class="payment-text">Stay tuned for updates when the Afro Smartchain launches on January 1st, 2024!</p>
    </div>

    <div class="payment-container">
        <h1 class="payment-heading">Bank Transfer</h1>
        <p class="payment-text">You can make a payment directly into our bank account for the purchase of AFRO Tokens from the developers' faucet at discounted rates. Please use the following bank details:</p>
        
        <h3>Account 01 Details</h3>
        <p class="payment-text">Bank Name: Moniepoint MfB</p>
        <p class="payment-text">Account Name: ZINGYPAY.COM </p>
        <p class="payment-text">Account Number:6349360169 </p>

        
    
        <h3>Account 03 Details</h3>
        <p class="payment-text">Bank Name: Wema Bank PLC</p>
        <p class="payment-text">Account Name: CHEAPBUY MARKETPLACE FLWFLW</p>
        <p class="payment-text">Account Number: 7812154849</p>

        
        <h3>Payment Details</h3>
        <p class="payment-text">Reference:  Payment for AFRO</p>
        <p class="payment-text">Amount: ₦10,000.00 for 5,000 tokens </p>
        <p class="payment-text">Amount: ₦15,000.00 for 7,600 tokens </p>
        <p class="payment-text">Amount: ₦20,000.00 for 10,800 tokens </p>
        <p class="payment-text">Amount: ₦25,000.00 for 12,900 tokens </p>
        <p class="payment-text">Amount: ₦30,000.00 for 20,000 tokens </p>
        <p class="payment-text">After making the payment, please use the chat widget at the bottom-right corner of the page, or send an email to admin@zingypay.com with proof of payment and your public key, and our team will process your AFRO Token purchase. You can as well call +2349058528334.</p>
    </div>
    
    
    


    <script src="https://cdnjs.cloudflare.com/ajax/libs/stellar-sdk/8.0.0/stellar-sdk.min.js"></script>
    <script>
        // Define Stellar server and assets for each token
        const server = new StellarSdk.Server('https://horizon.stellar.org');
        const tokenPairs = [
            { baseAssetCode: 'AFRO', counterAssetCode: 'XLM', issuerPublicKey: 'GBUYO263AYAZZKZI5ZCZFCPIGC42JVCGAOIP2CBBCUP2UTCEUIPIE2VV' },
            { baseAssetCode: 'ÇNB', counterAssetCode: 'XLM', issuerPublicKey: 'GAEESZVR52HUAHPOJZYWMWS7TYLSPS46IAK3ZDT7HTFBULDVOYUNEWCC' },
            { baseAssetCode: 'LIFE', counterAssetCode: 'XLM', issuerPublicKey: 'GBUYO263AYAZZKZI5ZCZFCPIGC42JVCGAOIP2CBBCUP2UTCEUIPIE2VV' },
            { baseAssetCode: 'NATURE', counterAssetCode: 'XLM', issuerPublicKey: 'GBUYO263AYAZZKZI5ZCZFCPIGC42JVCGAOIP2CBBCUP2UTCEUIPIE2VV' },
            { baseAssetCode: 'OSO', counterAssetCode: 'XLM', issuerPublicKey: 'GAEESZVR52HUAHPOJZYWMWS7TYLSPS46IAK3ZDT7HTFBULDVOYUNEWCC' }
            // Add more tokens as needed
        ];

        // Function to fetch and display token prices
        function fetchTokenPrices(baseAssetCode) {
            // Find the corresponding token pair
            const pair = tokenPairs.find((pair) => pair.baseAssetCode === baseAssetCode);
            if (!pair) {
                console.error('Invalid token selected.');
                return;
            }

            const counterAssetCode = pair.counterAssetCode;
            const counterAssetIssuer = pair.counterAssetIssuer;

            // Create Stellar assets for both base and counter assets
            const baseAsset = new StellarSdk.Asset(pair.baseAssetCode, pair.issuerPublicKey);
            const counterAsset = new StellarSdk.Asset(pair.counterAssetCode, pair.counterAssetIssuer);

            server.orderbook(baseAsset, counterAsset)
                .call()
                .then((orderbook) => {
                    const bidPriceXLM = parseFloat(orderbook.bids[0].price);
                    const askPriceXLM = parseFloat(orderbook.asks[0].price);

                    // Use fixed rates for XLM/USD and USD/NGN conversions
                    const xlmToUsdRate = 0.124; // Replace with your fixed XLM/USD rate
                    const usdToNgnRate = 810; // Replace with your fixed USD/NGN rate

                    // Calculate the equivalent prices in USD
                    const bidPriceUSD = bidPriceXLM * xlmToUsdRate;
                    const askPriceUSD = askPriceXLM * xlmToUsdRate;

                    // Update the HTML elements with the retrieved XLM prices
                    document.getElementById(`${baseAssetCode.toLowerCase()}-bid-price`).textContent = `Bid Price (XLM): ${bidPriceXLM.toFixed(7)}`;
                    document.getElementById(`${baseAssetCode.toLowerCase()}-ask-price`).textContent = `Ask Price (XLM): ${askPriceXLM.toFixed(7)}`;

                    // Update the HTML elements with the equivalent USD prices
                    document.getElementById(`${baseAssetCode.toLowerCase()}-bid-price-usd`).textContent = `Bid Price (USD): $${bidPriceUSD.toFixed(2)}`;
                    document.getElementById(`${baseAssetCode.toLowerCase()}-ask-price-usd`).textContent = `Ask Price (USD): $${askPriceUSD.toFixed(2)}`;

                    // Update the total amount if a token amount is entered
                    const tokenAmount = parseFloat(document.getElementById("amount").value);
                    if (!isNaN(tokenAmount)) {
                        updateTotalAmount(baseAssetCode, tokenAmount, askPriceUSD, usdToNgnRate);
                    }
                })
                .catch((error) => {
                    console.error('Error fetching orderbook:', error);
                });
        }

        // Function to update the total amount
        function updateTotalAmount(baseAssetCode, tokenAmount, askPriceUSD, usdToNgnRate) {
            // Calculate the total amount in USD
            const totalAmountUSD = tokenAmount * askPriceUSD;

            // Calculate the total amount in NGN
            const totalAmountNGN = totalAmountUSD * usdToNgnRate;

            // Update the HTML element with the total amount
            document.getElementById("total-amount").textContent = totalAmountUSD.toFixed(2);
            document.getElementById("total-amount-ngn").textContent = `Total Amount in NGN: ₦${totalAmountNGN.toFixed(2)}`;

            // Update the hidden Paystack amount input
            document.getElementById("paystack-amount").value = totalAmountUSD.toFixed(2);
        }

        // Function to handle token type selection
        function handleTokenTypeSelection() {
            const selectedToken = document.querySelector('input[name="token-type"]:checked').value;
            document.getElementById("selected-asset").value = selectedToken;
            fetchTokenPrices(selectedToken);
        }

        // Add an event listener to the token type radio buttons
        const tokenTypeRadios = document.querySelectorAll('input[name="token-type"]');
        tokenTypeRadios.forEach((radio) => {
            radio.addEventListener("change", handleTokenTypeSelection);
        });

        // Add an event listener to the amount input
        const amountInput = document.getElementById("amount");
        amountInput.addEventListener("input", () => {
            const selectedToken = document.getElementById("selected-asset").value;
            const tokenAmount = parseFloat(amountInput.value);
            if (!isNaN(tokenAmount)) {
                fetchTokenPrices(selectedToken);
                const askPriceUSD = parseFloat(document.getElementById(`${selectedToken.toLowerCase()}-ask-price-usd`).textContent.split(":")[1].trim());
                const usdToNgnRate = 810; // Replace with your fixed USD/NGN rate
                updateTotalAmount(selectedToken, tokenAmount, askPriceUSD, usdToNgnRate);
            }
        });

        // Calculate and display initial token prices
        const initialSelectedToken = document.querySelector('input[name="token-type"]:checked').value;
        fetchTokenPrices(initialSelectedToken);
        handleTokenTypeSelection(); // Handle the initial selection
    </script>



<!-- JavaScript code for Flutterwave integration -->
<script src="https://checkout.flutterwave.com/v3.js"></script>
<script>
    // Function to initialize the Flutterwave payment
    document.addEventListener('DOMContentLoaded', function() {
        function initializeFlutterwavePayment() {
            console.log("Function called");
            const selectedToken = document.querySelector('input[name="token-type"]:checked').value;
            const tokenAmount = parseFloat(document.getElementById("amount").value);
            const email = document.getElementById('user-email').value;
            const publicKey = "FLWPUBK-1bb9c7fe992d687e60cf5426fc1464e0-X"; // Replace with your Flutterwave public key

            // Get the user's Stellar public key from the form
            const userPublicKey = document.getElementById('user-wallet').value;

            // Generate a unique reference including token type and token amount
            const reference = `PURCHASE_${userPublicKey}_${selectedToken}_${tokenAmount}_${Date.now()}`;

            const totalAmountUSD = parseFloat(document.getElementById("total-amount").textContent);
            const usdToNgnRate = 810; // Replace with your fixed USD/NGN rate
            const amountInKobo = Math.round(totalAmountUSD * usdToNgnRate);

            // Get the user's full name and phone number from the form
            const fullName = document.getElementById('user-name').value;
            const phoneNumber = document.getElementById('user-phone').value;

            // Set the hidden input fields with the full name and phone number
            document.getElementById('user-fullname-flutterwave').value = fullName;
            document.getElementById('user-phone-number-flutterwave').value = phoneNumber;

            // Define your Flutterwave configuration here
            const config = {
                public_key: publicKey,
                tx_ref: reference,
                amount: amountInKobo,
                currency: "NGN",
                payment_type: "card, banktransfer, mobilemoneyghana, mobilemoneyfranco, barter, nqr",
                redirect_url: "https://zingytrader.zingypay.com",
                customer: {
                    email: email,
                    phone_number: phoneNumber,
                    name: name, // Use 'name' instead of 'full_name'
                },
                customizations: {
                    title: "ZingyPay",
                    description: "Payment for tokens",
                    logo: "https://res.cloudinary.com/dp7civtid/image/upload/v1691671447/zingypay_icon-1_opygpp.png",
                },
            };

            // Initialize Flutterwave
            const paymentModal = Flutterwave(config);

            // Open the Flutterwave payment modal
            paymentModal.open();
        }

        // Add an event listener for the Flutterwave payment button
        const flutterwaveButton = document.getElementById("flutterwave-button");
        flutterwaveButton.addEventListener("click", initializeFlutterwavePayment);
    });
</script>




<!-- JavaScript code for Paystack integration -->
<script src="https://js.paystack.co/v1/inline.js"></script>
<script>
    // Function to initialize the Paystack payment
    function initializePaystackPayment() {
        const selectedToken = document.querySelector('input[name="token-type"]:checked').value;
        const tokenAmount = parseFloat(document.getElementById("amount").value);
        const email = document.getElementById('user-email').value;
        const publicKey = "pk_live_081c6cf541c64f08115d6285e4b0b5d69953e651"; // Replace with your Paystack public key

        // Get the user's Stellar public key from the form
        const userPublicKey = document.getElementById('user-wallet').value;

        // Generate a unique reference using the user's Stellar public key
        const reference = `PURCHASE_${userPublicKey}_${Date.now()}`;

        const totalAmountUSD = parseFloat(document.getElementById("total-amount").textContent);
        const usdToNgnRate = 810; // Replace with your fixed USD/NGN rate
        const amountInKobo = Math.round(totalAmountUSD * usdToNgnRate * 100 + 2600);

        // Get the user's full name and phone number from the form
        const fullName = document.getElementById('user-name').value;
        const phoneNumber = document.getElementById('user-phone').value;

        // Set the hidden input fields with the full name and phone number
        document.getElementById('user-fullname').value = fullName;
        document.getElementById('user-phone-number').value = phoneNumber;

        // Create the Paystack handler
        var handler = PaystackPop.setup({
            key: publicKey,
            email: email,
            amount: amountInKobo, // Use the calculated amount in kobo
            currency: "NGN", // Use the appropriate currency code
            ref: reference, // Pass the unique reference here
            metadata: {
                custom_fields: [
                    {
                        display_name: "Token Type",
                        variable_name: "token_type",
                        value: selectedToken,
                    },
                    {
                        display_name: "Token Amount",
                        variable_name: "token_amount",
                        value: tokenAmount.toString(), // Convert token amount to string
                    },
                    {
                        display_name: "Full Name",
                        variable_name: "full_name",
                        value: fullName,
                    },
                    {
                        display_name: "Phone Number",
                        variable_name: "phone_number",
                        value: phoneNumber,
                    },
                ],
            },
            callback: function (response) {
                // Handle the Paystack callback response
                // Send the payment response to the backend for processing
                fetch('/paystack_payment_callback/', { // Adjust the URL to match your Django endpoint
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(response),
                })
                .then((response) => response.json())
                .then((data) => {
                    // Handle the backend response, which can include a success message
                    if (data.status === 'success') {
                        document.getElementById('transaction-status').textContent = "Payment successful!";
                    } else {
                        document.getElementById('transaction-status').textContent = "Payment failed or was canceled.";
                    }
                })
                .catch((error) => {
                    console.error('Error sending Paystack payment response to the backend:', error);
                });
            },
            onClose: function () {
                // Handle the case where the Paystack dialog is closed
                document.getElementById('transaction-status').textContent = "Payment dialog closed.";
            },
        });

        // Open the Paystack payment dialog
        handler.openIframe();
    }

    // Add an event listener for the Paystack payment button
    const paystackButton = document.getElementById("paystack-button");
    paystackButton.addEventListener("click", initializePaystackPayment);
</script>



</body>
{% endblock %}
